var app=angular.module("myApp",["ngRoute","homeCtrl","couponDirective","progressButton","ng.deviceDetector","sun.scrollable"]).config(["$routeProvider","$sceProvider",function(e,o){"use strict";o.enabled(!1),e.when("/",{controller:"HomeCtrl"}).when("/:section",{controller:"HomeCtrl"}).otherwise({redirectTo:"/"})}]);angular.module("homeCtrl",["ngDialog","ngStorage","angular-inview"]).controller("HomeCtrl",["$interval","$scope","ngDialog","couponsService","$log","$timeout","$localStorage","detectUtils","notificationService","promoCodeService","$rootScope","$window","$routeParams",function(e,o,t,n,s,l,r,i,a,c,u,p,d){"use strict";o.$on("$routeChangeSuccess",function(){switch(d.section){case"horizontal":o.scrollTo("desk-horizontal");break;case"vertical":o.scrollTo("desk-vertical");break;case"rollet":o.scrollTo("desk-rollet");break;case"zebra":o.scrollTo("desk-zebra");break;case"wood":o.scrollTo("desk-wood");break;case"contacts":o.scrollTo("desk-contacts")}}),o.collected=r.$default({counter:0}),o.floors=r.$default({floorsArray:[]}),o.currentCouponEl={},o.currentCouponId="",o.couponMessages=[],o.coupons=[],o.couponsOnStage=[],o.tooltipModals=[],o.userData={},o.userData.phone="+7",o.progress=[],o.progressMessage=[],o.isCallMe=!1,o.isCallMeZhaluzi=!1,o.isPromoCode=!1,o.isComment=!1,o.init=function(){o.setCouponsContainerWidth(),o.getCouponMessages(),o.getCoupons(),o.getTooltipModals(),o.isMobile()||o.skrollr(),(i.isDesktop()||i.isTablet())&&0===o.collected.counter&&o.openHelloModal(),o.map()},u.$on("ngDialog.opened",function(){o.lockScroll()}),o.lockScroll=function(){$(".ngdialog-overlay").on("DOMMouseScroll mousewheel",function(e){var o=$(this),t=this.scrollTop,n=this.scrollHeight,s=o.height(),l="DOMMouseScroll"==e.type?-40*e.originalEvent.detail:e.originalEvent.wheelDelta,r=l>0,i=function(){return e.stopPropagation(),e.preventDefault(),e.returnValue=!1,!1};return!r&&-l>n-s-t?(o.scrollTop(n),i()):r&&l>t?(o.scrollTop(0),i()):void 0})},angular.element(p).bind("scroll",function(){o.menuState&&(o.menuState=!1)}),o.simulateProgress=function(t,n,s,r){o.progress[t]=0;var i=e(function(){o.progress[t]+=.2,o.progress[t]>=1&&(e.cancel(i),o.progressMessage[t]=s,l(function(){o.progress[t]=0,o.progressMessage[t]="Send"},2e3),"function"==typeof r&&r())},n/5*1e3)},o.sendPromo=function(e){if(!e){var t={email:o.userData.email,promocodeId:o.collected.counter};c.sendPromoCode(t).then(function(){o.simulateProgress("promoCode",1,"Готово",function(){setTimeout(function(){o.progressMessage.promoCode="Отправить купон!"},1500)})},function(e){o.simulateProgress("promoCode",1,"Ошибка",function(){setTimeout(function(){o.progressMessage.promoCode="Отправить купон!"},1500)}),console.log(e)})}},o.sendCallMe=function(e){if(!e){var t={phone:o.userData.phone,header:"Перезвоните мне. Промо-сайт Дизайн окна",text:"Пользователь оставил свой номер телефона и попросил перезвонить."};a.sendUserData(t).then(function(){o.simulateProgress("callMe",1,"Готово",function(){setTimeout(function(){o.progressMessage.callMe="Жду звонка!"},1500)})},function(e){console.log(e),o.simulateProgress("callMe",1,"Ошибка",function(){setTimeout(function(){o.progressMessage.callMe="Жду звонка!"},1500)})})}},o.sendCallMeZhaluzi=function(e){if(!e){var t={phone:o.userData.phone,header:"Хочу заказать "+o.userData.zhaluziType+". Промо-сайт Дизайн окна",text:"Я хочу заказать "+o.userData.zhaluziType+" и задать по ним вопросы."};a.sendUserData(t).then(function(){o.simulateProgress("callMeZhaluzi",1,"Готово",function(){setTimeout(function(){o.progressMessage.callMeZhaluzi="Жду звонка!"},1500)})},function(e){o.simulateProgress("callMeZhaluzi",1,"Ошибка",function(){setTimeout(function(){o.progressMessage.callMeZhaluzi="Жду звонка!"},1500)}),console.log(e)})}},o.sendComment=function(e){if(!e){var t={email:o.userData.email,header:o.userData.name+" оставил комментарий. Промо-сайт Дизайн окна",text:o.userData.comment};a.sendUserData(t).then(function(){o.simulateProgress("comment",1,"Готово",function(){setTimeout(function(){o.progressMessage.comment="Отправить"},1500)})},function(e){console.log(e),o.simulateProgress("comment",1,"Ошибка",function(){setTimeout(function(){o.progressMessage.comment="Отправить"},1500)})})}},o.isMobile=function(){return i.isMobile()},o.scrollTo=function(e){var t=$("html, body"),n=$("#"+e)[0].offsetTop,s={};s["desk-horizontal"]=1,s["desk-wood"]=2,s["desk-rollet"]=3,s["desk-vertical"]=4,s["desk-zebra"]=5,o.mobileMenuState=!1,o.menuState=!1,setTimeout(function(){t.animate({scrollTop:n},"500",function(){}),setTimeout(function(){s[e]&&o.openTooltipModal(s[e])},800)},500)},o.getViewSize=function(){alert($(window).width()+"x"+$(window).height())},o.getTooltipModals=function(){n.getTooltipModals().then(function(e){o.tooltipModals=e},function(e){s.error(e)})},o.openAccordion=function(e){var o=$(e.target).parents(".accordion");o.hasClass("expanded")?o.removeClass("expanded"):($(".accordion").removeClass("expanded"),o.addClass("expanded"))},o.openTooltipModal=function(e){o.tooltipId=e,t.open({template:"views/modals/tooltip.html",scope:o,preCloseCallback:function(){},className:"ngdialog ngdialog_tooltip ngdialog-theme-default"})},o.openHelloModal=function(){t.open({template:"views/modals/hello.html",showClose:!1,scope:o,preCloseCallback:function(){},className:"ngdialog ngdialog_hello ngdialog-theme-default"})},o.openGetDiscountModal=function(){t.open({template:"views/modals/get-discount.html",scope:o,preCloseCallback:function(){},className:"ngdialog ngdialog_discount ngdialog-theme-default"})},o.map=function(){$(".js-map").gmap3({marker:{latLng:[55.648677,37.735566],options:{animation:"DROP",icon:{url:"img/pin.png"}}},map:{options:{center:[55.648677,37.735566],zoom:14,zoomControl:!0,navigationControl:!1,scrollwheel:!1,disableDefaultUI:!0,streetViewControl:!1,styles:[{featureType:"administrative",elementType:"labels.text.fill",stylers:[{color:"#444444"}]},{featureType:"landscape",elementType:"all",stylers:[{color:"#f2f2f2"}]},{featureType:"poi",elementType:"all",stylers:[{visibility:"off"}]},{featureType:"road",elementType:"all",stylers:[{saturation:-100},{lightness:45}]},{featureType:"road.highway",elementType:"all",stylers:[{visibility:"simplified"}]},{featureType:"road.arterial",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"transit",elementType:"all",stylers:[{visibility:"off"}]},{featureType:"water",elementType:"all",stylers:[{color:"#46bcec"},{visibility:"on"}]}]}}})},o.wow=function(){(new WOW).init()},o.setCouponsContainerWidth=function(){var e=$(".js-couponsContainer");e.css({width:1600})},o.getLocation=function(e){var o=$(".js-couponsContainer"),t=o.width(),n=($("body").height(),e.pageX),s=e.pageY;console.info(n/t*100+"%, "+s+"px")},o.getCouponMessages=function(){n.getMessages().then(function(e){o.couponMessages=e},function(e){s.error(e)})},o.getCoupons=function(){n.getAllCoupons().then(function(e){o.coupons=e,o.gambleCoupons()},function(e){s.error(e)})},o.random=function(e,o){return Math.floor(Math.random()*(o-e+1))+e},o.gambleCoupons=function(){var e=(o.coupons.length,[]);_.each(o.coupons,function(o,t){e.push(t+1)}),o.actualFloors=_.difference(e,o.floors.floorsArray);for(var t=0;t<o.actualFloors.length;t++){var n=o.coupons[o.actualFloors[t]-1].coupons.length-1,s=o.random(0,n),l=o.coupons[o.actualFloors[t]-1].coupons[s];l.floor=o.actualFloors[t],o.couponsOnStage.push(l)}},o.skrollr=function(){skrollr.init({smoothScrolling:!1,mobileDeceleration:.004})},o.openCollectModal=function(){t.open({template:"views/modals/coupon.html",preCloseCallback:function(){o.currentCouponEl.fadeOut("slow")},scope:o,className:"ngdialog ngdialog_coupon ngdialog-theme-default"})},o.discount=function(){return 2*o.collected.counter},o.menuToggle=function(){o.menuState=!o.menuState},o.mobileMenuToggle=function(){o.mobileMenuState=!o.mobileMenuState},o.collect=function(e,t){o.currentCouponEl=$(t.currentTarget),o.currentCouponId=e,o.collected.counter++,o.currentCouponEl.find(".js-coupon").addClass("collected"),o.currentCouponEl.addClass("cbutton--click"),setTimeout(function(){o.openCollectModal()},500),o.floors.floorsArray.push(o.currentCouponId)},o.clearCollected=function(){localStorage.clear(),location.reload()},o.init()}]),angular.module("horizontalCtrl",[]).controller("HorizontalCtrl",["$scope",function(){"use strict";console.log("horizontal")}]),angular.module("couponDirective",[]).controller("couponCtrl",["$scope",function(){"use strict"}]).directive("coupon",[function(){"use strict";return{restrict:"E",templateUrl:"views/coupon/index.html",scope:{},replace:!0,link:function(e,o,t){var n=t.location.split(","),s=$.trim(n[0]),l=$.trim(n[1]);e.id=t.id,e.floor=t.floor,e.img=t.img,e.type=t.type,o.css({left:s,top:l})}}}]),app.service("couponsService",["$http","$q",function(e,o){var t=this;return t.couponMessages={},t.tooltipModals={},t.coupons=[],t.getTooltipModals=function(){var n=o.defer();return e.get("data/tooltip-modals.json").success(function(e){t.tooltipModals=e,n.resolve(e)}).error(function(e){n.reject(e)}),n.promise},t.getMessages=function(){var n=o.defer();return e.get("data/coupon-messages.json").success(function(e){t.couponMessages=e,n.resolve(e)}).error(function(e){n.reject(e)}),n.promise},t.getAllCoupons=function(){var n=o.defer();return e.get("data/coupons.json").success(function(e){t.coupons=e,n.resolve(e)}).error(function(e){n.reject(e)}),n.promise},t}]),app.service("notificationService",["$http","$q",function(e,o){var t=this;return t.sendUserData=function(t){var n=o.defer();return e.post("send_notification.php",t).success(function(e){n.resolve(e)}).error(function(e){n.reject(e)}),n.promise},t}]),app.service("promoCodeService",["$http","$q",function(e,o){var t=this;return t.sendPromoCode=function(t){var n=o.defer();return e.post("send_promocode.php",t).success(function(e){n.resolve(e)}).error(function(e){n.reject(e)}),n.promise},t}]);
//# sourceMappingURL=../js/app.js.map